FROM golang:latest

ARG POSTGRES_HOST
ARG POSTGRES_PORT
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG POSTGRES_NAME
ARG POSTGRES_SSLMODE
ARG PORT=8080
ARG HMAC_API_KEY
ARG MINIO_USER
ARG MINIO_PASS
ARG MINIO_PORT
ARG MINIO_HOST
ARG MINIO_USE_SSL

ENV POSTGRES_HOST=${POSTGRES_HOST}
ENV POSTGRES_PORT=${POSTGRES_PORT}
ENV POSTGRES_USER=${POSTGRES_USER}
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV POSTGRES_NAME=${POSTGRES_NAME}
ENV POSTGRES_SSLMODE=${POSTGRES_SSLMODE}
ENV PORT=${PORT}
ENV HMAC_API_KEY=${HMAC_API_KEY}
ENV MINIO_USER=${MINIO_USER}
ENV MINIO_PASS=${MINIO_PASS}
ENV MINIO_PORT=${MINIO_PORT}
ENV MINIO_HOST=${MINIO_HOST}
ENV MINIO_USE_SSL=${MINIO_USE_SSL}

WORKDIR /app

COPY go.mod go.sum ./

RUN go mod download

COPY *.go ./

COPY ./internal/ ./internal

RUN CGO_ENABLED=0 GOOS=linux go build -o /blog-backend

EXPOSE 8080 

CMD ["/blog-backend"]

